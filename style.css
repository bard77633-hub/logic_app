/* --- 基本設定 --- */
body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-family: sans-serif;
    overflow: hidden; /* スクロールバーを無効化 */
    user-select: none; /* テキスト選択を無効化 */
    -webkit-user-select: none;
    -ms-user-select: none;
    touch-action: none; /* タッチでのパン/ズームを無効化 */
    background-color: #f0f0f0;
}

#workspace {
    position: relative;
    width: 100%;
    height: 100%;
}

/* --- パレット --- */
#palette {
    position: fixed;
    top: 0;
    left: 0;
    width: 180px;
    height: 100%;
    background-color: #333;
    color: white;
    padding: 10px;
    box-sizing: border-box;
    z-index: 100;
}
#palette h3 {
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
    margin-top: 15px;
}
#palette button {
    display: block;
    width: 100%;
    padding: 10px;
    margin-bottom: 8px;
    background-color: #555;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 14px;
    text-align: left;
}
#palette button:hover {
    background-color: #666;
}
#palette button.active {
    background-color: #007bff;
    font-weight: bold;
}
#reset-button {
    margin-top: 20px;
    background-color: #c0392b;
}
#reset-button:hover {
    background-color: #e74c3c;
}


/* --- キャンバス --- */
#canvas {
    position: absolute;
    top: 0;
    left: 180px; /* パレットの幅 */
    right: 0;
    bottom: 0;
    background-color: #ffffff;
    background-image:
        linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
    background-size: 20px 20px;
    overflow: hidden;
}

/* --- 結線レイヤー --- */
#wire-layer {
    position: absolute;
    top: 0;
    left: 180px;
    right: 0;
    bottom: 0;
    width: calc(100% - 180px);
    height: 100%;
    pointer-events: none; /* SVG自体はクリックできないようにする */
    z-index: 10;
}
.wire {
    stroke: #333;
    stroke-width: 3;
    fill: none;
}
.wire.on { /* ONの状態のワイヤー */
    stroke: #00ff00;
    stroke-width: 4;
}
.wire-dragging { /* ドラッグ中の仮線 */
    stroke: #007bff;
    stroke-width: 3;
    stroke-dasharray: 5,5;
}

/* --- コンポーネント共通 --- */
.component {
    position: absolute;
    width: 80px;
    height: 50px;
    background-color: #fff;
    border: 2px solid #333;
    border-radius: 5px;
    cursor: grab;
    z-index: 20;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
}
.component:active {
    cursor: grabbing;
    z-index: 30; /* ドラッグ中は最前面に */
}

/* --- 端子（入出力点） --- */
.terminal {
    position: absolute;
    width: 16px;
    height: 16px;
    background-color: #fff;
    border: 2px solid #333;
    border-radius: 50%;
    z-index: 25;
    cursor: crosshair;
    /* pointer-events: auto; SVGが透けていても反応させる */
}
.terminal.out {
    right: -10px;
    top: 50%;
    transform: translateY(-50%);
}
.terminal.in-0 {
    left: -10px;
    top: 25%;
    transform: translateY(-50%);
}
.terminal.in-1 {
    left: -10px;
    top: 75%;
    transform: translateY(-50%);
}

/* --- 各コンポーネントのスタイル --- */
/* INPUT (スイッチ) */
.component.INPUT {
    width: 60px;
    background-color: #f1c40f;
    cursor: pointer;
}
.component.INPUT.on {
    background-color: #f39c12;
    color: #fff;
}
.component.INPUT .terminal.in-0,
.component.INPUT .terminal.in-1 {
    display: none; /* INPUTに入力端子はない */
}

/* OUTPUT (LED) */
.component.OUTPUT {
    width: 60px;
    background-color: #bdc3c7;
    border-radius: 50%;
    height: 60px;
}
.component.OUTPUT.on { /* ONのLED */
    background-color: #2ecc71;
    box-shadow: 0 0 15px #2ecc71;
}
.component.OUTPUT .terminal.out {
    display: none; /* OUTPUTに出力端子はない */
}
.component.OUTPUT .terminal.in-1 {
    display: none; /* 入力は1つ */
    top: 50%;
}
.component.OUTPUT .terminal.in-0 {
    top: 50%;
}


/* ANDゲート (D型) */
.component.AND {
    border-radius: 5px 25px 25px 5px; /* D型 */
}

/* ORゲート (D型 + 湾曲) */
.component.OR {
    border-radius: 5px 25px 25px 5px;
    border-left: none; /* 左の線を消す */
}
.component.OR::before { /* 左側の湾曲を描画 */
    content: '';
    position: absolute;
    left: -2px;
    top: -2px;
    width: 40px;
    height: 50px;
    border: 2px solid #333;
    border-right: none;
    border-radius: 25px 0 0 25px;
}


/* NOTゲート (三角) */
.component.NOT {
    width: 0;
    height: 0;
    background-color: transparent;
    border-style: solid;
    border-width: 25px 0 25px 40px; /* 三角形 */
    border-color: transparent transparent transparent #333;
    border-radius: 0;
}
.component.NOT .label {
    position: absolute;
    left: -35px;
    top: -9px;
    color: #fff;
    z-index: 1;
}
.component.NOT .terminal.in-0 {
    left: -42px;
    top: 0;
    transform: translateY(-50%);
}
.component.NOT .terminal.in-1 {
    display: none;
}
.component.NOT .terminal.out {
    /* 丸（バブル）で表現 */
    right: -50px;
    top: 0;
    transform: translateY(-50%);
    width: 10px;
    height: 10px;
}
